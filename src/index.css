@tailwind base;
@tailwind components;
@tailwind utilities;
/* ─────────────────────────────────────────────────────────────────────────────
 Design System (HSL variables, retro colors)
───────────────────────────────────────────────────────────────────────────── */
@layer base {
  :root {
    --background: 0 0% 18%;
    --foreground: 0 0% 90%;
    --card: 0 0% 22%;
    --card-foreground: 0 0% 90%;
    --popover: 0 0% 20%;
    --popover-foreground: 0 0% 90%;
    --primary: 0 0% 70%;
    --primary-foreground: 0 0% 10%;
    --secondary: 200 15% 45%;
    --secondary-foreground: 0 0% 95%;
    --muted: 0 0% 28%;
    --muted-foreground: 0 0% 60%;
    --accent: 330 40% 50%;
    --accent-foreground: 0 0% 100%;
    --destructive: 0 65% 50%;
    --destructive-foreground: 0 0% 100%;
    --border: 0 0% 30%;
    --input: 0 0% 30%;
    --ring: 0 0% 70%;
    --radius: 0.25rem;
    /* Retro palette */
    --amiga-light-grey: 0 0% 80%;
    --amiga-mid-grey: 0 0% 60%;
    --amiga-dark-grey: 0 0% 40%;
    --amiga-blue: 210 60% 55%;
    --amiga-orange: 30 75% 55%;
    --amiga-green: 120 50% 50%;
    --amiga-red: 0 70% 55%;
    /* Extra neon vars used by shadows */
    --neon-cyan: 190 100% 50%;
    --neon-purple: 280 60% 55%;
  }
  .dark {
    --background: 0 0% 18%;
    --foreground: 0 0% 90%;
  }
}
/* Basic keyframes */
@keyframes scrollOutLeft {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(-200%);
  }
}
@keyframes scrollInRight {
  from {
    transform: translateX(200%);
  }
  to {
    transform: translateX(0);
  }
}
@layer base {
  * {
    @apply border-border;
  }
  html,
  body,
  #root {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    min-height: 100dvh;
    overflow: hidden;
    /* Aggressive iOS Safari gesture prevention */
    touch-action: pan-y !important;
    overscroll-behavior-x: none !important;
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
  }
  body {
    @apply bg-background text-foreground;
    font-family: "Press Start 2P", system-ui, monospace;
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
  }
  .retro-pixel-text {
    font-family: "Press Start 2P", monospace;
    text-shadow: 2px 2px 0px hsl(var(--amiga-dark-grey));
    letter-spacing: 0.05em;
  }
  .amiga-box {
    background: linear-gradient(135deg, hsl(0, 0%, 25%) 0%, hsl(0, 0%, 20%) 100%);
    border: 3px solid hsl(0, 0%, 40%);
    border-top-color: hsl(0, 0%, 50%);
    border-left-color: hsl(0, 0%, 50%);
    box-shadow:
      inset 1px 1px 0px hsl(0, 0%, 55%),
      inset -1px -1px 0px hsl(0, 0%, 15%),
      0 0 0 1px hsl(0, 0%, 10%);
  }
  /* Canvas wrapper glow — ALWAYS centered (added) */
  .game-glow {
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow:
      0 0 16px hsl(var(--neon-cyan) / 0.2),
      0 0 32px hsl(var(--neon-purple) / 0.15);
  }
  /* Canvas block formatting */
  .game-glow canvas {
    display: block;
  } /* removes baseline gap */

  /* Mobile canvas constraints (desktop uses hook sizing) */
  @media (max-width: 768px) {
    .game-glow canvas {
      max-width: 92vw; /* side panels hidden on mobile */
      max-height: 75vh;
      width: auto !important;
      height: auto !important;
      object-fit: contain;
    }
  }

  .neon-text {
    text-shadow:
      0 0 6px currentColor,
      0 0 12px currentColor;
  }
  /* High Score animations */
  @keyframes float {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-20px);
    }
  }
  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }
  @keyframes rainbow {
    0% {
      filter: hue-rotate(0deg);
    }
    100% {
      filter: hue-rotate(360deg);
    }
  }
  .animate-float {
    animation: float 3s ease-in-out infinite;
  }
  .animate-shimmer {
    animation: shimmer 2s linear infinite;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    background-size: 1000px 100%;
  }
  .animate-rainbow {
    animation: rainbow 3s linear infinite;
  }
  .retro-title {
    background: linear-gradient(90deg, hsl(280, 60%, 55%), hsl(330, 70%, 55%), hsl(200, 70%, 50%), hsl(280, 60%, 55%));
    background-size: 200% auto;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: retro-shine 3s linear infinite;
    text-shadow: 0 0 20px hsl(280, 60%, 55%);
  }
  @keyframes retro-shine {
    0% {
      background-position: 0% center;
    }
    100% {
      background-position: 200% center;
    }
  }
  .retro-border {
    border: 4px solid;
    border-image: linear-gradient(45deg, hsl(280, 60%, 55%), hsl(200, 70%, 50%), hsl(330, 70%, 55%), hsl(280, 60%, 55%))
      1;
    animation: border-glow 2s ease-in-out infinite alternate;
  }
  @keyframes border-glow {
    0% {
      box-shadow: 0 0 20px hsl(280, 60%, 55% / 0.5);
    }
    100% {
      box-shadow: 0 0 40px hsl(200, 70%, 50% / 0.7);
    }
  }
  .retro-row {
    animation: slide-in 0.5s ease-out backwards;
  }
  @keyframes slide-in {
    0% {
      transform: translateX(-100px);
      opacity: 0;
    }
    100% {
      transform: translateX(0);
      opacity: 1;
    }
  }
  .retro-button {
    animation: button-pulse 1.5s ease-in-out infinite;
  }
  @keyframes button-pulse {
    0%,
    100% {
      box-shadow: 0 0 10px hsl(200, 70%, 50% / 0.5);
    }
    50% {
      box-shadow: 0 0 30px hsl(280, 60%, 55% / 0.8);
    }
  }
  .animate-scale-in {
    animation: scale-in-center 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
  }
  @keyframes scale-in-center {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
}
/* ─────────────────────────────────────────────────────────────────────────────
 Metal Frame Interface (base, non-fullscreen)
───────────────────────────────────────────────────────────────────────────── */
.metal-frame {
  background: linear-gradient(135deg, hsl(210, 15%, 35%) 0%, hsl(210, 15%, 45%) 50%, hsl(210, 15%, 35%) 100%);
  border: 12px ridge hsl(210, 15%, 50%);
  border-radius: 8px;
  box-shadow:
    0 0 0 2px hsl(210, 15%, 20%),
    0 0 0 4px hsl(210, 15%, 55%),
    0 20px 60px rgba(0, 0, 0, 0.6),
    inset 0 2px 4px rgba(255, 255, 255, 0.1);
  padding: 8px;
  max-width: 1400px; /* non-fullscreen default */
  width: fit-content; /* non-fullscreen default */
  max-height: 100vh; /* slightly relaxed from 98vh to reduce clipping (changed) */
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  /* Aggressive iOS Safari gesture prevention */
  touch-action: pan-y !important;
  overscroll-behavior-x: none !important;
  overscroll-behavior: none;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
}
.metal-title-bar {
  background: linear-gradient(180deg, hsl(210, 20%, 25%) 0%, hsl(210, 20%, 18%) 100%);
  border: 3px ridge hsl(210, 15%, 50%);
  border-radius: 4px;
  padding: 12px 16px;
  margin-bottom: 6px;
  box-shadow:
    inset 0 1px 2px rgba(0, 0, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.3);
}
.metal-stats-bar {
  background: linear-gradient(180deg, hsl(210, 15%, 40%) 0%, hsl(210, 15%, 32%) 100%);
  border: 3px ridge hsl(210, 15%, 50%);
  border-radius: 4px;
  padding: 8px 12px;
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  box-shadow:
    inset 0 1px 2px rgba(0, 0, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.3);
}
/* Center region between title and bottom bar */
.metal-main-content {
  display: flex;
  gap: 8px;
  margin-bottom: 6px;
  flex: 1;
  overflow: hidden;
  justify-content: center;
  /* CRITICAL: allow children to shrink so canvas stays fully visible (added) */
  min-height: 0;
}
.metal-side-panel {
  background: linear-gradient(180deg, hsl(210, 15%, 38%) 0%, hsl(210, 15%, 30%) 100%);
  border: 3px ridge hsl(210, 15%, 50%);
  border-radius: 4px;
  width: 60px;
  flex-shrink: 0; /* Prevent shrinking */
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 15px 8px;
  box-shadow:
    inset 0 1px 2px rgba(0, 0, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.3);
}
.metal-side-panel-right {
  width: 140px;
  padding: 12px;
  gap: 8px;
}
.right-panel-btn {
  background: linear-gradient(180deg, hsl(210, 15%, 45%) 0%, hsl(210, 15%, 35%) 100%);
  border: 2px ridge hsl(210, 15%, 55%);
  border-radius: 4px;
  padding: 10px;
  color: hsl(0, 0%, 85%);
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
}
.right-panel-btn:hover {
  background: linear-gradient(180deg, hsl(210, 15%, 50%) 0%, hsl(210, 15%, 40%) 100%);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}
.right-stat-box {
  background: linear-gradient(180deg, hsl(210, 20%, 22%) 0%, hsl(210, 20%, 16%) 100%);
  border: 2px inset hsl(210, 15%, 45%);
  border-radius: 3px;
  padding: 6px 8px;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
}
.right-stat-label {
  font-size: 7px;
  font-family: "Press Start 2P", monospace;
  text-align: center;
  margin-bottom: 4px;
  font-weight: bold;
  letter-spacing: 0.5px;
}
.right-stat-value {
  font-size: 12px;
  font-family: "Press Start 2P", monospace;
  text-align: center;
  color: hsl(0, 0%, 90%);
  text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
}
.panel-decoration {
  background: linear-gradient(180deg, hsl(210, 20%, 20%) 0%, hsl(210, 20%, 14%) 100%);
  border: 2px inset hsl(210, 15%, 45%);
  border-radius: 4px;
  height: 50px;
  box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.7);
}
/* Game area container (non-fullscreen baseline) */
.metal-game-area {
  background: linear-gradient(180deg, hsl(210, 15%, 30%) 0%, hsl(210, 15%, 22%) 100%);
  border: 4px ridge hsl(210, 15%, 50%);
  border-radius: 4px;
  padding: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  box-shadow:
    inset 0 2px 4px rgba(0, 0, 0, 0.6),
    0 2px 4px rgba(0, 0, 0, 0.3);
  flex: 1; /* grow within main content */
  max-width: calc(100% - 220px); /* account for side panels (60 + 140) + gaps */
  min-width: 0;
  /* CRITICAL: ensures inner wrapper/canvas can use full height (added) */
  min-height: 0;
}
.metal-bottom-bar {
  background: linear-gradient(180deg, hsl(210, 15%, 40%) 0%, hsl(210, 15%, 32%) 100%);
  border: 3px ridge hsl(210, 15%, 50%);
  border-radius: 4px;
  padding: 12px;
  box-shadow:
    inset 0 1px 2px rgba(0, 0, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.3);
}
/* ─────────────────────────────────────────────────────────────────────────────
 DESKTOP FULLSCREEN — authoritative, height-safe layout
 (applied when your hook adds the `.desktop-fullscreen` class)
───────────────────────────────────────────────────────────────────────────── */
@media (min-width: 769px) {
  .metal-frame.desktop-fullscreen {
    position: fixed;
    inset: 0; /* fills viewport; border included via box-sizing */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-width: 8px;
    margin: 0;
    border-radius: 0;
  }

  /* Header/Footer retain natural height; center consumes remaining space */
  .metal-main-content {
    display: flex;
    flex-direction: row;
    flex: 1 1 auto;
    min-height: 0; /* critical: allow full height */
    min-width: 0;
    gap: 8px;
    align-items: stretch; /* allow children to take full height */
  }

  /* Sidebars remain fixed width */
  .metal-side-panel-left {
    flex: 0 0 60px;
    min-width: 60px;
  }
  .metal-side-panel-right {
    flex: 0 0 140px;
    min-width: 140px;
  }

  /* Game area fills remaining space — remove inner padding in fullscreen (changed) */
  .metal-frame.desktop-fullscreen .metal-game-area {
    flex: 1 1 auto;
    min-width: 0;
    min-height: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 !important; /* removed padding to let canvas reach the inner edge */
    box-sizing: border-box;
    max-width: none; /* remove width constraint in fullscreen */
  }

  /* Inner wrapper centered; exact px size comes from ResizeObserver hook */
  .game-glow {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* IMPORTANT: Do NOT force canvas width/height here; the hook sets them. */
  .game-glow canvas {
    display: block;
    max-width: 100%;
    max-height: 100%;
  }
}
/* ─────────────────────────────────────────────────────────────────────────────
 Responsive adjustments (non-fullscreen)
───────────────────────────────────────────────────────────────────────────── */
@media (max-width: 1200px) {
  .metal-frame {
    border: 8px ridge hsl(210, 15%, 50%);
    padding: 6px;
  }
  .metal-side-panel {
    width: 50px;
    flex-shrink: 0;
    padding: 12px 6px;
    gap: 12px;
  }
  .metal-side-panel-right {
    width: 120px;
    padding: 10px;
  }
  .metal-game-area {
    max-width: calc(100% - 210px);
  } /* left 50 + right 120 */
  .right-stat-label {
    font-size: 6px;
  }
  .right-stat-value {
    font-size: 10px;
  }
  .right-panel-btn {
    padding: 8px;
  }
  .panel-decoration {
    height: 40px;
  }
  .metal-title-bar {
    padding: 8px 12px;
    margin-bottom: 4px;
  }
}
@media (max-width: 768px) {
  .metal-frame {
    border: 4px ridge hsl(210, 15%, 50%);
    padding: 4px;
    max-width: 100vw;
  }
  /* Hide side panels on mobile */
  .metal-side-panel {
    display: none;
  }
  .metal-title-bar {
    padding: 6px 8px;
    margin-bottom: 3px;
  }
  .metal-game-area {
    padding: 4px;
    max-width: 100%;
  }
  .metal-bottom-bar {
    padding: 8px;
  }
  .fullscreen-btn {
    padding: 6px 8px;
  }
}
/* ─────────────────────────────────────────────────────────────────────────────
 Mobile FULLSCREEN MODE — remove frame chrome (unchanged)
───────────────────────────────────────────────────────────────────────────── */
.metal-frame.mobile-fullscreen-mode {
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
  box-shadow: none !important;
  width: 100vw;
  height: 100dvh;
  max-width: 100vw;
  max-height: 100dvh;
  margin: 0;
  /* Block all gestures in fullscreen */
  touch-action: none !important;
  -webkit-overflow-scrolling: auto !important;
  overscroll-behavior: none !important;
  overscroll-behavior-x: none !important;
  -webkit-touch-callout: none !important;
  -webkit-user-select: none !important;
}
.metal-frame.mobile-fullscreen-mode .metal-title-bar,
.metal-frame.mobile-fullscreen-mode .metal-bottom-bar,
.metal-frame.mobile-fullscreen-mode .metal-side-panel,
.metal-frame.mobile-fullscreen-mode .metal-side-panel-left,
.metal-frame.mobile-fullscreen-mode .metal-side-panel-right {
  display: none !important;
}
.metal-frame.mobile-fullscreen-mode .metal-main-content {
  width: 100vw;
  height: 100dvh;
  margin: 0;
  padding: 0;
  gap: 0;
}
.metal-frame.mobile-fullscreen-mode .metal-game-area {
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
  box-shadow: none !important;
  max-width: 100vw;
  width: 100vw;
  height: 100dvh;
  border-radius: 0;
}
.metal-frame.mobile-fullscreen-mode .game-glow {
  width: 100vw !important;
  height: 100dvh !important;
  box-shadow: none !important;
}
.metal-frame.mobile-fullscreen-mode .game-glow canvas {
  max-width: 100vw !important;
  max-height: 100dvh !important;
  width: 100vw !important;
  height: 100dvh !important;
}
/* ─────────────────────────────────────────────────────────────────────────────
 iOS Fullscreen Simulation container
───────────────────────────────────────────────────────────────────────────── */
.ios-fullscreen-container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100vw;
  height: 100vh;
  height: 100dvh; /* dynamic viewport height */
  overflow: hidden;
  z-index: 9999;
  background: hsl(var(--background));
  /* Aggressive iOS gesture blocking */
  touch-action: pan-y !important;
  overscroll-behavior: none !important;
  overscroll-behavior-x: none !important;
  -webkit-touch-callout: none !important;
  -webkit-user-select: none !important;
}
/* Force minimal UI on iOS Safari */
@supports (-webkit-touch-callout: none) {
  .ios-fullscreen-container {
    position: fixed;
    width: 100%;
    height: 100%;
    height: -webkit-fill-available;
  }
}
/* ─────────────────────────────────────────────────────────────────────────────
 CRT Monitor Effects
───────────────────────────────────────────────────────────────────────────── */
.crt-scanlines {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9998;
  background: repeating-linear-gradient(
    0deg,
    rgba(0, 0, 0, 0.08) 0px,
    transparent 1px,
    transparent 2px,
    rgba(0, 0, 0, 0.08) 3px
  );
}
.crt-scanlines.crt-high {
  animation: scanline-flicker 0.1s infinite alternate;
}
.crt-scanlines.crt-medium {
  opacity: 0.7;
}
@keyframes scanline-flicker {
  0% {
    opacity: 0.95;
  }
  100% {
    opacity: 1;
  }
}
.crt-screen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9997;
  border-radius: 2% / 3%;
}
.crt-screen.crt-high {
  background: radial-gradient(ellipse at center, transparent 0%, transparent 60%, rgba(0, 0, 0, 0.15) 100%);
  animation: screen-flicker 5s infinite;
}
.crt-screen.crt-medium {
  background: radial-gradient(ellipse at center, transparent 0%, transparent 70%, rgba(0, 0, 0, 0.08) 100%);
}
@keyframes screen-flicker {
  0% {
    opacity: 0.98;
  }
  2% {
    opacity: 0.95;
  }
  4% {
    opacity: 1;
  }
  19% {
    opacity: 0.98;
  }
  21% {
    opacity: 0.92;
  }
  23% {
    opacity: 1;
  }
  80% {
    opacity: 0.99;
  }
  83% {
    opacity: 0.96;
  }
  87% {
    opacity: 1;
  }
}
.crt-phosphor {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9996;
  mix-blend-mode: screen;
}
.crt-phosphor.crt-high {
  background: radial-gradient(ellipse at center, rgba(0, 255, 200, 0.02) 0%, transparent 50%);
}
.crt-phosphor.crt-medium {
  background: radial-gradient(ellipse at center, rgba(0, 255, 200, 0.01) 0%, transparent 50%);
  opacity: 0.5;
}
/* Reduce intensity on small screens */
@media (max-width: 480px) {
  .crt-scanlines {
    opacity: 0.5;
  }
  .crt-screen {
    background: radial-gradient(ellipse at center, transparent 0%, transparent 70%, rgba(0, 0, 0, 0.2) 100%);
  }
}
/* ─────────────────────────────────────────────────────────────────────────────
 Usability helpers: swipe, scroll, scrollbar styles
───────────────────────────────────────────────────────────────────────────── */
.swipe-container {
  touch-action: pan-y !important;
  overscroll-behavior-x: none !important;
  -webkit-touch-callout: none !important;
  -webkit-user-select: none !important;
}
.smooth-scroll {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  overscroll-behavior: contain;
}
/* Custom scrollbar (WebKit) */
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: hsl(210, 20%, 15%);
  border-radius: 4px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, hsl(200, 70%, 50%) 0%, hsl(200, 70%, 35%) 100%);
  border-radius: 4px;
  border: 1px solid hsl(200, 70%, 60%);
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, hsl(200, 70%, 60%) 0%, hsl(200, 70%, 45%) 100%);
}
/* Firefox scrollbar */
.custom-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: hsl(200, 70%, 50%) hsl(210, 20%, 15%);
}
/* Boss Rush themed scrollbar */
.boss-rush-scrollbar::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, hsl(0, 70%, 50%) 0%, hsl(30, 70%, 50%) 100%);
  border: 1px solid hsl(15, 70%, 60%);
}
.boss-rush-scrollbar::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, hsl(0, 70%, 60%) 0%, hsl(30, 70%, 60%) 100%);
}
.boss-rush-scrollbar {
  scrollbar-color: hsl(15, 70%, 50%) hsl(210, 20%, 15%);
}
